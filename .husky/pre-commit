set -euo pipefail

# Only run checks for packages that have staged changes
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR)

if echo "$STAGED_FILES" | grep -q '^packages/component-library/'; then
  echo "ğŸ§ª Component library quick checks..."
  npm run lint --workspace=packages/component-library
  npm run test:unit --workspace=packages/component-library
fi

if echo "$STAGED_FILES" | grep -q '^packages/shared-utils/'; then
  echo "ğŸ§© Shared utils tests..."
  npm run test --workspace=packages/shared-utils
fi

if echo "$STAGED_FILES" | grep -q '^packages/app/'; then
  echo "ğŸ—ï¸ App lint + typecheck..."
  npm run lint --workspace=packages/app
  npm run typecheck --workspace=packages/app
fi

if echo "$STAGED_FILES" | grep -q '^packages/'; then
  echo "ğŸ“Š Running FTA analysis..."
  npm run analyze:fta
fi
